define("mod_projetvet/tagselect",["exports","core/templates"],(function(_exports,_templates){var obj;
/**
   * Tag select form element helpers.
   *
   * @module     mod_projetvet/tagselect
   * @copyright  2025 Bas Brands <bas@sonsbeekmedia.nl>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj};class TagSelect{constructor(elementId,maxTags){this.elementId=elementId,this.maxTags=maxTags||0,this.selectElement=document.getElementById(elementId),this.wrapper=document.querySelector('[data-element-id="'.concat(elementId,'"]')),this.selectElement&&this.wrapper&&(this.popup=this.wrapper.querySelector('[data-region="tagselect-popup"]'),this.searchInput=this.popup.querySelector('[data-region="tag-search"]'),this.selectedTagsDisplay=this.wrapper.querySelector('[data-region="selected-tags-display"]'),this.selectedTagsPopup=this.popup.querySelector('[data-region="selected-tags-popup"]'),this.tagCount=this.wrapper.querySelector('[data-region="tag-count"]'),this.warningsRegion=this.popup.querySelector('[data-region="warnings"]'),this.addEventListeners())}addEventListeners(){var _this$wrapper$querySe,_this$popup$querySele,_this$searchInput,_this$popup$querySele2;null===(_this$wrapper$querySe=this.wrapper.querySelector('[data-action="open-tagselect"]'))||void 0===_this$wrapper$querySe||_this$wrapper$querySe.addEventListener("click",(()=>{this.openPopup()})),this.popup.querySelectorAll('[data-action="close-tagselect"]').forEach((btn=>{btn.addEventListener("click",(()=>{this.closePopup()}))})),null===(_this$popup$querySele=this.popup.querySelector('[data-action="save-tags"]'))||void 0===_this$popup$querySele||_this$popup$querySele.addEventListener("click",(()=>{this.saveTags()})),this.popup.querySelectorAll('[data-action="select-tag"]').forEach((link=>{link.addEventListener("click",(e=>{e.preventDefault();const tagId=link.dataset.tagId,tagName=link.dataset.tagName;this.addTag(tagId,tagName)}))})),this.wrapper.addEventListener("click",(e=>{const removeBtn=e.target.closest('[data-action="remove-tag"]');if(removeBtn){e.preventDefault();const tagId=removeBtn.dataset.tagId;this.removeTag(tagId)}})),this.popup.addEventListener("click",(e=>{const removeBtn=e.target.closest('[data-action="remove-tag-popup"]');if(removeBtn){e.preventDefault();const tagId=removeBtn.dataset.tagId;this.removeTag(tagId)}})),null===(_this$searchInput=this.searchInput)||void 0===_this$searchInput||_this$searchInput.addEventListener("input",(()=>{this.filterTags()})),null===(_this$popup$querySele2=this.popup.querySelector('[data-action="toggle-all"]'))||void 0===_this$popup$querySele2||_this$popup$querySele2.addEventListener("click",(()=>{this.toggleAll()}))}openPopup(){var _this$searchInput2;this.popup.classList.remove("d-none"),null===(_this$searchInput2=this.searchInput)||void 0===_this$searchInput2||_this$searchInput2.focus()}closePopup(){this.popup.classList.add("d-none"),this.searchInput.value="",this.filterTags()}saveTags(){this.updateDisplay(),this.closePopup()}addTag(tagId,tagName){const option=this.selectElement.querySelector('option[value="'.concat(tagId,'"]'));if(option&&option.selected)return;const selectedCount=this.selectElement.querySelectorAll("option:checked").length;this.maxTags>0&&selectedCount>=this.maxTags?this.updateWarnings(!0):(option&&(option.selected=!0),this.addTagBadge(tagId,tagName,this.selectedTagsPopup),this.updateCount(),this.updateWarnings(!1))}removeTag(tagId){const option=this.selectElement.querySelector('option[value="'.concat(tagId,'"]'));option&&(option.selected=!1);const popupBadge=this.selectedTagsPopup.querySelector('[data-tag-id="'.concat(tagId,'"]'));popupBadge&&popupBadge.remove();this.selectedTagsDisplay.querySelectorAll('[data-action="remove-tag"]').forEach((btn=>{btn.dataset.tagId===tagId&&btn.closest(".badge").remove()})),this.updateCount(),this.updateWarnings(!1)}async addTagBadge(tagId,tagName,container){if(container.querySelector('[data-tag-id="'.concat(tagId,'"]')))return;const context={tagid:tagId,tagname:tagName,action:container===this.selectedTagsPopup?"remove-tag-popup":"remove-tag"},{html:html,js:js}=await _templates.default.renderForPromise("mod_projetvet/tagselect_badge",context);_templates.default.appendNodeContents(container,html,js)}async updateDisplay(){this.selectedTagsDisplay.innerHTML="";const selectedOptions=this.selectElement.querySelectorAll("option:checked");for(const option of selectedOptions){const context={tagid:option.value,tagname:option.textContent,action:"remove-tag"},{html:html,js:js}=await _templates.default.renderForPromise("mod_projetvet/tagselect_badge",context);_templates.default.appendNodeContents(this.selectedTagsDisplay,html,js)}}updateCount(){const count=this.selectElement.querySelectorAll("option:checked").length;this.tagCount&&(this.tagCount.textContent=count)}updateWarnings(showMaxWarning){this.warningsRegion&&(showMaxWarning&&this.maxTags>0?(this.warningsRegion.textContent="Maximum of ".concat(this.maxTags," selections allowed."),this.warningsRegion.classList.remove("d-none")):(this.warningsRegion.textContent="",this.warningsRegion.classList.add("d-none")))}filterTags(){const searchTerm=this.searchInput.value.toLowerCase();this.popup.querySelector('[data-region="tag-list"]').querySelectorAll('[data-action="select-tag"]').forEach((item=>{item.dataset.tagName.toLowerCase().includes(searchTerm)?(item.classList.remove("d-none"),this.highlightMatch(item,searchTerm)):item.classList.add("d-none")}))}highlightMatch(element,searchTerm){const tagName=element.dataset.tagName;if(!searchTerm)return void(element.innerHTML=tagName);const index=tagName.toLowerCase().indexOf(searchTerm);if(-1===index)return void(element.innerHTML=tagName);const before=tagName.slice(0,index),match=tagName.slice(index,index+searchTerm.length),after=tagName.slice(index+searchTerm.length);element.innerHTML="".concat(before,"<strong>").concat(match,"</strong>").concat(after)}toggleAll(){this.popup.querySelector('[data-region="tag-list"]').querySelectorAll('[data-action="select-tag"]:not(.d-none)').forEach((item=>{const tagId=item.dataset.tagId,tagName=item.dataset.tagName,option=this.selectElement.querySelector('option[value="'.concat(tagId,'"]'));option&&!option.selected&&this.addTag(tagId,tagName)}))}}var _default={init:(elementId,maxTags)=>{new TagSelect(elementId,maxTags)}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=tagselect.min.js.map